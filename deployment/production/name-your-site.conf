server {
    listen 80;
    server_name name-your-startup.site www.name-your-startup.site;
    server_tokens             off;
    root                      /dev/null;

    location /.well-known {
      alias /var/www/name-your-startup.site/.well-known/;
    }
    
    location / {
      return 301 https://$host$request_uri;
    }
}

server {
  listen                    443   ssl http2;
  server_name               name-your-startup.site www.name-your-startup.site;
  server_tokens             off;
  root                      /dev/null;

  ## Increase this if you want to upload larger attachments
  client_max_body_size      200m;

  ## SSL
  ssl                       on;

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_prefer_server_ciphers on;
  ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
  ssl_ecdh_curve secp384r1; # Requires nginx >= 1.1.0
  ssl_session_cache shared:SSL:10m;
  #ssl_session_tickets off; # Requires nginx >= 1.5.9  
  #resolver $DNS-IP-1 $DNS-IP-2 valid=300s;
  #resolver_timeout 5s;  
  add_header X-Frame-Options DENY;
  add_header X-Content-Type-Options nosniff;


  ssl_certificate /etc/letsencrypt/live/name-your-startup.site/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/name-your-startup.site/privkey.pem;

  # Turn on OCSP stapling as recommended at
  # https://community.letsencrypt.org/t/integration-guide/13123
  # requires nginx version >= 1.3.7
  ssl_stapling on;
  ssl_stapling_verify on;

  # Uncomment this line only after testing in browsers,
  # as it commits you to continuing to serve your site over HTTPS
  # in future
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";


  ## Individual nginx logs for this vhost
  #access_log                /var/log/nginx/gitlab_ssl_access.log;
  #error_log                 /var/log/nginx/gitlab_ssl_error.log;
 
    location /content/ {
        alias /var/www/name-your-startup.site/content/;
        location ~* ^.+\.(jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|pdf|txt|tar|wav|bmp|rtf|js|flv|swf|html|htm|svg)$ {
            expires 365d;
        }
    }

  location / {
    ## If you use https make sure you disable gzip compression
    ## to be safe against BREACH attack.
    gzip                    off;

    proxy_read_timeout      300;
    proxy_connect_timeout   300;
    proxy_redirect          off;

    proxy_set_header        Host                $http_host;
    proxy_set_header        X-Real-IP           $remote_addr;
    proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
    proxy_set_header        X-Forwarded-Proto   https;
    proxy_set_header        X-Frame-Options     SAMEORIGIN;
    proxy_http_version      1.1;
    proxy_set_header        Upgrade             $http_upgrade;
    proxy_set_header        Connection          keep-alive;    
    proxy_cache_bypass      $http_upgrade;

    proxy_pass http://localhost:4455;
  }
}
